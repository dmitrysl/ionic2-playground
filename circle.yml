machine:
  environment:
    XCODE_SCHEME: "ionic2-playground"
    XCODE_PROJECT: "ionic2-playground.xcodeproj"
  node:
    version: 6.5.0
general:
  branches:
    only:
    - master
dependencies:
  pre:
   - brew list -1 | while read line; do brew unlink $line; brew link $line; done
   - brew install node && sudo brew postinstall node
   - brew install caskroom/cask/brew-cask
   - brew cask install java
   - brew install android-sdk
   - ( sleep 5 && while [ 1 ]; do sleep 1; echo y; done ) | android update sdk --no-ui --all --filter platform-tools,build-tools-22.0.1,android-22
  override:
    - sudo npm cache clean
    - sudo npm install -g ionic@beta
    - sudo npm install -g cordova
#    - sudo npm install -g bamlab/cordova-deploy
    - npm install
    - ionic state restore
    - ionic prepare
#    - ./builds/sign-ios.sh
test:
  override:
    - echo "Do your tests here"
    # start the emulator
    - emulator -avd circleci-android22 -no-audio -no-window:
        background: true
        parallel: true
    # wait for it to have booted
    - circle-android wait-for-boot
    - ionic run android
#    - npm test
#    - npm run build
#    - gulp build
#deployment:
#  staging:
#    branch: master
#    commands:
#      - ionic upload --note "NOTE" --deploy CHANNEL_TAG
#      - cordova-deploy --build --android --ios --iosid $HOCKEY_IOS_APP_ID --apikey $HOCKEY_API_KEY --apk ./platforms/android/build/outputs/apk/android-debug.apk --andid  $HOCKEY_ANDROID_APP_ID --notes "Version automatically generated by $CIRCLE_USERNAME"
